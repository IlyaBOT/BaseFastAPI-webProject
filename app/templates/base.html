<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>{{ title if title else "My FastAPI Project" }}</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <h1 class="logo roboto-font"><a href="/">FastAPI Web-Project</a></h1>
        <nav>
          <ul>
            {% if not user %}
                <li><a href="/login">–í—Ö–æ–¥</a></li>
            {% endif %}
            {% if not user %}
                <li><a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
            {% endif %}
            {% if user %}
                <li class="nav-user">
                <a href="/user/{{ user.id }}">
                    {% if user.avatar %}
                        <img class="nav-avatar-small" src="data:image/png;base64,{{ user.avatar }}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è" width="42" height="42">
                    {% else %}
                        <img class="nav-avatar-small" src="{{ request.url_for('resources', path='img/base_avatar.svg') }}" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è" width="42" height="42">
                    {% endif %}
                    <span class="nav-username">{{ user.nickname }}</span>
                </a>
                </li>
            {% endif %}
            {% if user and user.is_admin %}
                <li><a href="/admin">–ê–¥–º–∏–Ω–∫–∞</a></li>
            {% endif %}
            <button id="theme-toggle-btn" class="theme-toggle-btn">üåì</button>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container">{% block content %}{% endblock %}</main>

    <footer>
      <div class="container roboto-font">
        <p>&copy; IB-WorkShop. 2025. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
      </div>
    </footer>

    <script>
      (function () {
        const toggleBtn = document.getElementById("theme-toggle-btn");
        const root = document.documentElement;

        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–º—É –∏–∑ localStorage –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π
        const saved = localStorage.getItem("theme");
        if (saved) {
          root.setAttribute("data-theme", saved);
        } else {
          // –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã ‚Äî –º–æ–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é
          const mq = window.matchMedia("(prefers-color-scheme: dark)");
          if (mq.matches) {
            root.setAttribute("data-theme", "dark");
          }
        }

        toggleBtn.addEventListener("click", () => {
          const current = root.getAttribute("data-theme");
          const next = current === "dark" ? "light" : "dark";
          root.setAttribute("data-theme", next);
          localStorage.setItem("theme", next);
        });
      })();
    </script>
  </body>
</html>
